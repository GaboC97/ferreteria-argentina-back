<?php\n\nnamespace App\\Http\\Controllers\\Auth;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\Cliente;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Http\\JsonResponse;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Hash;\nuse Illuminate\Validation\\Rules;\nuse Illuminate\\Validation\\ValidationException;\n\nclass AuthController extends Controller\n{\n    /**\n     * Maneja la solicitud de registro para la API.\n     */\n    public function register(Request $request): JsonResponse\n    {\n        $request->validate([\n            \'nombre\' => [\'required\', \'string\', \'max:120\'],\n            \'apellido\' => [\'required\', \'string\', \'max:120\'],\n            \'email\' => [\'required\', \'string\', \'email\', \'max:160\', \'unique:clientes\'],\n            \'password\' => [\'required\', \'confirmed\', Rules\\Password::defaults()],\n        ]);\n\n        $cliente = Cliente::create([\n            \'nombre\' => $request->nombre,\n            \'apellido\' => $request->apellido,\n            \'email\' => $request->email,\n            \'password\' => Hash::make($request->password),\n            \'condicion_iva\' => \'Consumidor Final\', // Valor por defecto al registrarse\n        ]);\n\n        Auth::login($cliente);\n\n        $request->session()->regenerate();\n\n        return response()->json(Auth::user(), 201);\n    }\n\n    /**\n     * Maneja la solicitud de inicio de sesión para la API.\n     */\n    public function login(Request $request): JsonResponse\n    {\n        $credentials = $request->validate([\n            \'email\' => [\'required\', \'email\'],\n            \'password\' => [\'required\'],\n        ]);\n\n        if (Auth::attempt($credentials, $request->boolean(\'remember\'))) {\n            $request->session()->regenerate();\n\n            return response()->json(Auth::user());\n        }\n\n        throw ValidationException::withMessages([\n            \'email\' => [\'Las credenciales proporcionadas no coinciden con nuestros registros.\'],\n        ]);\n    }\n\n    /**\n     * Cierra la sesión del cliente para la API.\n     */\n    public function logout(Request $request): JsonResponse\n    {\n        Auth::logout();\n\n        $request->session()->invalidate();\n\n        $request->session()->regenerateToken();\n\n        return response()->json([\'message\' => \'Sesión cerrada correctamente.\']);\n    }\n}\n